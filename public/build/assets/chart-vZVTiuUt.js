import{C as b,p as f}from"./chartjs-plugin-datalabels.esm-CglBOSix.js";import{c as o}from"./chart_color-DSS5FTIa.js";$(document).ready(function(){k()});function k(){$.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/dashboard/ajax_get_chart_data",type:"GET",data:{},dataType:"json",success:function(t){try{let a=[],l=[],r=[];$.each(t.regions,function(e,n){a.push(n.region_name)});const g={labels:a,datasets:[m(t.regions)]};$.each(t.bases,function(e,n){l.push(n.short_base_name)});const c={labels:l,datasets:[F(t.bases)]};$.each(t.sales_rank_counts,function(e,n){r.push(n.sales_rank_name)});const p={labels:r,datasets:[z(t.sales_rank_counts)]},y=document.getElementById("clients_count_chart_by_region").getContext("2d"),C=document.getElementById("clients_count_chart_by_base").getContext("2d"),h=document.getElementById("sales_rank_chart").getContext("2d"),B=new b(y,{data:g,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{label:function(e){return e.formattedValue}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6}}}}),R=new b(C,{data:c,options:{responsive:!1,scales:{"y-axis-1":{type:"linear",position:"left",ticks:{max:200,min:0,stepSize:10}}},plugins:{legend:{labels:{usePointStyle:!0}},tooltip:{callbacks:{label:function(e){return e.formattedValue}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6}}}}),S=new b(h,{data:p,options:{responsive:!1,plugins:{legend:{labels:{boxWidth:0,usePointStyle:!1}},tooltip:{callbacks:{label:function(e){const n=e.raw,i=e.chart.data.datasets[e.datasetIndex].data.reduce((u,_)=>u+_,0),d=(n/i*100).toFixed(1);return n+" ("+d+"%)"}},bodyFont:{size:14},titleFont:{size:16},padding:12,boxPadding:6},datalabels:{color:"#000",font:{weight:"bold",size:15},formatter:(e,n)=>{const i=n.chart.data.datasets[0].data.reduce((u,_)=>u+_,0),d=(e/i*100).toFixed(1);return e+`
(`+d+"%)"},anchor:"center",align:"center"}}},plugins:[f]})}catch{alert("グラフの生成に失敗しました。")}},error:function(){alert("グラフの生成に失敗しました。")}})}function m(s){const t=o[0];let a=[];return $.each(s,function(l,r){a.push(r.clients_count)}),{type:"bar",label:"顧客数(地域別)",data:a,borderColor:t.borderColor,backgroundColor:t.backgroundColor,pointBackgroundColor:t.borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function F(s){const t=o[1];let a=[];return $.each(s,function(l,r){a.push(r.clients_count)}),{type:"bar",label:"顧客数(倉庫別)",data:a,borderColor:t.borderColor,backgroundColor:t.backgroundColor,pointBackgroundColor:t.borderColor,pointRadius:5,pointHoverRadius:7,yAxisID:"y-axis-1",borderRadius:30}}function z(s){let t=[];$.each(s,function(g,c){t.push(c.count)});const a=new Date,l=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0");return{type:"pie",label:`顧客数(売上ランク別) ${l}年${r}月`,data:t,borderColor:[o[0].borderColor,o[1].borderColor,o[5].borderColor,o[3].borderColor,o[4].borderColor],backgroundColor:[o[0].backgroundColor,o[1].backgroundColor,o[5].backgroundColor,o[3].backgroundColor,o[4].backgroundColor],pointBackgroundColor:[o[0].borderColor,o[1].borderColor,o[5].borderColor,o[3].borderColor,o[4].borderColor],yAxisID:"y-axis-pie"}}
